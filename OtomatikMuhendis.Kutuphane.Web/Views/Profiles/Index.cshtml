@using OtomatikMuhendis.Kutuphane.Web.Enums
@model OtomatikMuhendis.Kutuphane.Web.ViewModels.ProfileViewModel
@{
    Layout = "_ProfileLayout";
    ViewData[ViewDataParameters.Title] = Model.User.Name;
    ViewData[ViewDataParameters.UserId] = Model.User.Id;
    ViewData[ViewDataParameters.Tab] = Model.Tab;
}

@section UserInfo
{
    <h2>@Model.User.Name</h2>
    @if (Model.ShowActions && !Model.IsProfileOwner)
    {
        <button type="button" data-user-id="@Model.User.Id" class="btn btn-@Html.Raw(Model.IsFollowing ? "success" : "default") btn-lg js-toggle-follow">Follow</button>
    }
}

@foreach (var shelf in Model.Shelves)
{
    <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading">
            <div class="row">
                <div class="col-md-10">
                    <h3 class="panel-title">@shelf.Title</h3>
                </div>
                <div class="col-md-2">
                    @if (Model.ShowActions)
                    {
                        <button data-shelf-id="@shelf.Id" type="button" class="btn btn-default btn-xs pull-right js-toggle-star">
                            <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
                        </button>
                    }
                </div>
            </div>
        </div>
        <div class="panel-body">
            <p><a asp-controller="Profiles" asp-action="Index" asp-route-userId="@shelf.CreatedById">@shelf.CreatedBy.Name</a> on @shelf.CreationDate.ToLongDateString()</p>
        </div>
        <!-- Table -->
        <table class="table table-hover">
            <thead> <tr> <th>#</th> <th>Book</th> </tr> </thead>
            <tbody>
            @{ var i = 0;}
            @foreach (var book in shelf.Books)
            {
                <tr> <th class="col-md-1" scope="row">@Html.Raw(++i)</th> <td>@book.Title</td> </tr>
            }
            </tbody>
        </table>
    </div>
}

@section Scripts{
    <script>
        $(document).ready(function() {
            $(".js-toggle-star").click(function(e) {
                var button = $(this);
                
                $.post("/api/stars", { shelfId: button.data("shelf-id") })
                    .done(function() {
                        button
                            .removeClass("btn-default")
                            .addClass("btn-warning");
                    })
                    .fail(function () {
                        //TODO Clean up javascript
                        alert("Something failed!");
                    });
            });

            $(".js-toggle-follow").click(function (e) {
                var button = $(this);

                $.post("/api/followings", { followeeId: button.data("user-id") })
                    .done(function () {
                        button
                            .removeClass("btn-default")
                            .addClass("btn-success");
                    })
                    .fail(function () {
                        //TODO Clean up javascript
                        alert("Something failed!");
                    });
            });
        });
    </script>
}