var URLModule=function(){var n=function(n){var t=new URLSearchParams(window.location.hash.substr(1));return t.get(n)},t=function(){return n("q")},i=function(){return n("p")},r=function(){var n="#",i=t();return i&&(n+="q="+i),n+"&p="};return{getQuery:t,getPage:i,getCurrentHash:r}}(),StarService=function(){var n=function(n,t,i){$.post({url:"/api/stars",data:{shelfId:n},headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)};return{toggleStar:n}}(),FollowingService=function(){var n=function(n,t,i){$.post({url:"/api/followings",data:{followeeId:n},headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)},t=function(n,t,i){$.get({url:"/api/"+n+"/followings",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)},i=function(n,t,i){$.get({url:"/api/"+n+"/followers",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)};return{toggleFollow:n,getFollowings:t,getFollowers:i}}(),ShelfService=function(){var n=function(n,t){$.get("/shelves").done(n).fail(t)},t=function(n,t,i,r){$.get({url:"/api/"+n+"/shelves?page="+t,headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(i).fail(r)},i=function(n,t,i,r){$.get({url:"/api/shelves?page="+n+(t?"&query="+t:""),headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(i).fail(r)},r=function(n,t,i,r){$.get({url:"/api/"+n+"/starredShelves?page="+t,headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(i).fail(r)},u=function(n,t,i){$.ajax({url:"/api/shelves/"+n,method:"DELETE",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)},f=function(n,t,i){$.ajax({url:"/api/shelves/"+n+"/public",method:"PATCH",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)},e=function(n,t,i){$.ajax({url:"/api/shelves/"+n+"/private",method:"PATCH",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)},o=function(n,t,i,r){$.ajax({url:"/api/shelves/"+n,method:"PATCH",data:{title:t},headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(i).fail(r)};return{getForm:n,get:t,getPublic:i,getStarred:r,remove:u,makePublic:f,makePrivate:e,rename:o}}(),ItemService=function(){var n=function(n,t,i){$.ajax({url:"/api/items/"+n,method:"DELETE",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(t).fail(i)},t=function(n,t,i,r,u,f){$.post({url:"/api/items/",data:{shelfId:i,gBookId:n,gameId:t,title:r},headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(u).fail(f)};return{remove:n,add:t}}(),NotificationService=function(){var n=function(n){$.getJSON("/api/notifications/",n)},t=function(n){$.post({url:"/api/notifications/",headers:{RequestVerificationToken:$('input[name="__RequestVerificationToken"]').val()}}).done(n)};return{get:n,read:t}}(),StarModule=function(n){var t,i=function(n){$(n).on("click",".js-toggle-star",r)},r=function(){t=$(this);n.toggleStar(t.data("shelf-id"),u,f)},u=function(n){n==="starred"?t.removeClass("btn-default").addClass("btn-warning"):t.removeClass("btn-warning").addClass("btn-default")},f=function(){swal("Something failed!","We could not process your request.","error")};return{init:i}}(StarService),ShelfModule=function(n){var t=function(n){swal("Something failed!","We could not process your request. "+n.responseText,"error")},i=function(n){var t=".bootbox-body";bootbox.dialog({title:"New Shelf",onEscape:!0,backdrop:!0,message:n,buttons:{cancel:{label:"Cancel",className:"btn-danger-soft"},confirm:{label:"Create",className:"btn-teal",callback:function(){var n=$(t+" form")[0];if(n.checkValidity()===!1)return n.classList.add("was-validated"),!1;n.submit()}}},onShown:function(){$(t+" #Title").focus()}})},r=function(r){r.preventDefault();n.getForm(i,t)},u=function(){$(document).on("click",".js-add-shelf",r)};return{init:u}}(ShelfService),ItemModule=function(n){var t,i=function(n){swal("Something failed!","We could not process your request. "+n.responseText,"error")},r=function(n){var i=`/shelves/${t}/items/${n}/`;window.location=i},u=function(){t=$(this).data("shelfid");bootbox.prompt({title:"Title for the new item",onEscape:!0,backdrop:!0,required:!0,callback:function(u){u&&n.add(null,null,t,u,r,i)}})},f=function(){$(document).on("click",".js-add-item",u)};return{init:f}}(ItemService),FollowingModule=function(n){var t,i=function(n){$(n).on("click",".js-toggle-follow",r)},r=function(){t=$(this);n.toggleFollow(t.data("user-id"),u,f)},u=function(n){n==="following"?t.removeClass("btn-default").addClass("btn-success"):t.removeClass("btn-success").addClass("btn-default")},f=function(){swal("Something failed!","We could not process your request.","error")};return{init:i}}(FollowingService),PaginationModule=function(n){var i=function(t,i,u){var f=r(t,i),e=_.template($("#pagination-template").html()),o=n.getCurrentHash();$(u).html(e({currentPage:t,pageCount:i,pages:f,currentHash:o}))};const t=(n,t)=>Array(t-n+1).fill().map((t,i)=>i+n),r=(n,i)=>{var u,r;u=i<=7?7:n>4&&n<i-3?2:4;const f={start:Math.round(n-u/2),end:Math.round(n+u/2)};(f.start-1==1||f.end+1===i)&&(f.start+=1,f.end+=1);r=n>u?t(Math.min(f.start,i-u),Math.min(f.end,i)):t(1,Math.min(i,u+1));const e=(n,t)=>r.length+1!==i?t:[n];return r[0]!==1&&(r=e(1,[1,"..."]).concat(r)),r[r.length-1]<i&&(r=r.concat(e(i,["...",i]))),r};return{init:i}}(URLModule),ProfileController=function(n,t,i,r,u,f){var s,h,c,o,e=function(n){swal("Something failed!","We could not process your request. "+n.responseText,"error")},l=function(n,t){var i=_.template($(s).html());bootbox.dialog({title:n,message:i({followers:t}),backdrop:!0,onEscape:!0,scrollable:!0})},a=function(n){var t=_.template($(h).html());$("#divShelves").html(t({shelves:n.list}));u.init(n.currentPage,n.pageCount,"#navShelves")},y=function(n){l("Followers",n)},p=function(n){l("Followings",n)},v=function(){var n=f.getPage();(!n||n<=0)&&(n=1);c==="Shelves"?i.get(o,n,a,e):i.getStarred(o,n,a,e)},w=function(i,u,f,l,a){s=f;h=l;o=u;c=a;t.init(i);n.init(i);window.onhashchange=v;v();$(document).on("click","#btnFollowers",function(){r.getFollowers(u,y,e)});$(document).on("click","#btnFollowing",function(){r.getFollowings(u,p,e)})};return{init:w}}(FollowingModule,StarModule,ShelfService,FollowingService,PaginationModule,URLModule),ShelfController=function(n,t,i){var r,u=function(){swal("Something failed!","We could not process your request.","error")},e=function(n){r=n;i.init();$(".js-remove-book").click(y);$("#js-remove-shelf").click(a);$("#js-rename-shelf").click(h);$("#js-operation").on("click","#js-makePublic-shelf",o);$("#js-operation").on("click","#js-makePrivate-shelf",s)},o=function(n){n.preventDefault();t.makePublic(r.id,c,u)},s=function(n){n.preventDefault();t.makePrivate(r.id,l,u)},h=function(n){n.preventDefault();bootbox.prompt({title:"Rename Shelf",onEscape:!0,backdrop:!0,value:r.title,required:!0,callback:function(n){n&&t.rename(r.id,n,function(){$("#spnTitle").html(n);r.title=n},u)}})},c=function(){$("#js-makePublic-shelf").hide();$("#js-makePrivate-shelf").show();$("#lblIsPublic").hide()},l=function(){$("#js-makePublic-shelf").show();$("#js-makePrivate-shelf").hide();$("#lblIsPublic").show()},a=function(n){n.preventDefault();swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this shelf!",icon:"warning",buttons:!0,dangerMode:!0}).then(n=>{n&&t.remove(r.id,v,u)})},v=function(){window.location="/p/"+r.userName},f,y=function(){f=$(this);swal({title:"Are you sure?",text:"Once deleted, you will not be able to recover this book!",icon:"warning",buttons:!0,dangerMode:!0}).then(t=>{t&&n.remove(f.data("book-id"),p,u)})},p=function(){f.parents(".thumbnail").fadeOut(function(){$(this).remove();salvattore.recreateColumns(document.querySelector("#grid"))})};return{init:e}}(ItemService,ShelfService,ItemModule),HomeController=function(n,t,i,r){var u,e=function(n){swal("Something failed!","We could not process your request. "+n.responseText,"error")},o=function(n){var t=_.template($(u).html());$("#divShelves").html(t({shelves:n.list}));i.init(n.currentPage,n.pageCount,"#navShelves")},f=function(){var n=r.getPage(),i=r.getQuery();(!n||n<=0)&&(n=1);t.getPublic(n,i,o,e)},s=function(t,i){n.init(t);u=i;window.onhashchange=f;f();$("#frmSearch").on("submit",function(n){n.preventDefault();location.hash="q="+$("#inputQuery").val()})};return{init:s}}(StarModule,ShelfService,PaginationModule,URLModule),NotificationController=function(n){var i,t,r=function(r,f){i=r;t=f;n.get(u)},u=function(r){var u,f;if(r.length!==0){u=0;$.each(r,function(n,t){t.isRead||u++});u>0&&($(t+" .js-notifications-count").text(u).removeClass("hide"),$(t+" .fa-bell").addClass("animate__animated animate__swing animate__repeat-2"));f=_.template($(i).html());$(t+" .dropdown-menu").html(f({notifications:r}));$(t).on("shown.bs.dropdown",function(){n.read(function(){$(t+" .js-notifications-count").text("").addClass("hide")})})}};return{init:r}}(NotificationService),BookController=function(n){var t,i=function(){$("#js-select-shelf").change(r);$(".js-add-book").click(u)},r=function(){var n=$("#js-select-shelf option:selected");$(".js-add-book").attr("data-original-title","Add to "+n.text())},u=function(){var r=$("#js-select-shelf option:selected").val(),i;t=$(this).data("title");i=$(this).data("book-id");n.add(i,null,r,t,f,e)},f=function(){var n=$("#js-select-shelf option:selected");swal("New book!",t+" is added successfully to "+n.text()+".","success")},e=function(n){swal("Something failed!","We could not process your request. "+n.responseText,"error")};return{init:i}}(ItemService),GameController=function(n){var t,i=function(){$("#js-select-shelf").change(r);$(".js-add-game").click(u)},r=function(){var n=$("#js-select-shelf option:selected");$(".js-add-book").attr("data-original-title","Add to "+n.text())},u=function(){var r=$("#js-select-shelf option:selected").val(),i;t=$(this).data("title");i=$(this).data("game-id");n.add(null,i,r,t,f,e)},f=function(){var n=$("#js-select-shelf option:selected");swal("New game!",t+" is added successfully to "+n.text()+".","success")},e=function(n){swal("Something failed!","We could not process your request. "+n.responseText,"error")};return{init:i}}(ItemService),ItemController=function(){var n=function(n){$("#file").change(function(){var n=$(this).val();n&&$("#frmUploadCover").submit()});$("#frmUploadCover").on("submit",function(i){i.preventDefault();var u=$(this),r=!1;window.FormData&&(r=new FormData(u[0]));$.ajax({url:"/api/items/"+n+"/cover",data:r?r:u.serialize(),cache:!1,contentType:!1,processData:!1,type:"PUT",success:function(n){t(n)}})})},t=function(n){$("header").css("background-image","url("+n+")");swal("Image uploaded!","The cover image is uploaded successfully.","success")},i=function(n){swal("Something failed!","We could not process your request. "+n.responseText,"error")};return{init:n}}(ItemService);